<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xml:lang>

<head>
    <th:block th:replace="~{fragments/essentials/header :: header}" />
    <title>My Website</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!--/*JQuery */-->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

    <!--/*PopperJS */-->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"></script>

    <!--/*Bootstrap */-->
    <script src=" https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js "></script>

    <!--/*Bootstrap Icons*/-->
    <link href=" https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.min.css " rel="stylesheet">

    <!--/*Bootswatch */-->
    <link href=" https://cdn.jsdelivr.net/npm/bootswatch@5.3.2/dist/cerulean/bootstrap.min.css " rel="stylesheet">

    <!--/*Backbone.js */-->
    <script src="https://cdn.jsdelivr.net/npm/backbone@1.5.0/backbone-min.min.js"></script>

    <!--/*Underscore.js */-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.13.6/underscore-min.js"></script>


    <!--/*JQuery UI */-->
    <script src=" https://cdn.jsdelivr.net/npm/jqueryui@1.11.1/jquery-ui.min.js "></script>
    <link href=" https://cdn.jsdelivr.net/npm/jqueryui@1.11.1/jquery-ui.min.css " rel="stylesheet">
    </th:block>
    <title>My Website</title>
</head>

<body>
    
    <script>

        // Define the label dimensions
        var labelDimensions = [
            { width: 2, height: 1, template: "2x1.html", name: "2 by 1 labels" },
            { width: 2, height: 3, template: "2x3.html", name: "2 by 3 labels" },
            { width: 3, height: 2, template: "3x2.html", name: "3 by 2 labels" },
            { width: 4, height: 2, template: "4x2.html", name: "4 by 2 labels" },
            { width: 5, height: 3, template: "5x3.html", name: "5 by 3 labels" },
            { width: 8, height: 4, template: "8x4.html", name: "8 by 4 labels" },
        ];
    </script>

    <select id="labelDimensionsDropdown" onchange="updateGrid(); updateImageGrid()" >
        <option value="">Select Label Dimension</option>
        <script>
            // Dynamically populate the label dimensions dropdown
            labelDimensions.forEach(function (dimension) {
                var option = document.createElement("option");
                option.value = dimension.template;
                option.text = dimension.name;
                document.getElementById("labelDimensionsDropdown").appendChild(option);
            });

        </script>
    </select>

    <div id="gridContainer"></div>

    <div id="imageGridContainer"></div>

    <script>

       
        var imageDropdownData = [

        ]

        function populateImageDropdown() {
            // Make a GET request to retrieve available labels
            request = new XMLHttpRequest();
            request.open('GET', 'http://localhost:8080/api/labels/getAvailableLabels?userToken=0', true);
            request.onload = function () {
                // Begin accessing JSON data here
                var data = JSON.parse(this.response);
                if (request.status >= 200 && request.status < 400) {
                    data.forEach(label => {
                        imageDropdownData.push({ name: label.name, url: label.url });
                    });
                } else {
                    // If no labels are available, display a message
                    imageDropdownData.push({ name: "No labels available", url: "" });

                    console.log('error');
                }
            }
            request.send();
            // Wait for the request to complete
            setTimeout(function () {
                // Populate the dropdowns
                var dropdowns = document.getElementsByClassName("imageDropdown");
                for (var i = 0; i < dropdowns.length; i++) {
                    var dropdown = dropdowns[i];
                    dropdown.innerHTML = "";
                    imageDropdownData.forEach(function (image) {
                        var option = document.createElement("option");
                        option.value = image.url;
                        option.text = image.name;

                        dropdown.appendChild(option);
                    });
                }
            }, 1000);

        }

        var ratioX = 4;
        var ratioY = 3;

        function updateGrid() {
            var selectedTemplate = document.getElementById("labelDimensionsDropdown").value;
            var selectedDimension = labelDimensions.find(function (dimension) {
                return dimension.template === selectedTemplate;
            });

            // Update the ratio
            ratioX = selectedDimension.width;
            ratioY = selectedDimension.height;

            var gridContainer = document.getElementById("gridContainer");
            gridContainer.innerHTML = "";

            for (var i = 0; i < selectedDimension.height; i++) {
                var row = document.createElement("div");
                row.classList.add("row");

                for (var j = 0; j < selectedDimension.width; j++) {
                    var col = document.createElement("div");
                    col.classList.add("col");
                    col.textContent = "Cell " + (i * selectedDimension.width + j + 1);
                    col.id = "cell" + (i * selectedDimension.width + j + 1);

                    var dropdown = document.createElement("select");
                    dropdown.classList.add("imageDropdown");

                    var number = (i * selectedDimension.width + j + 1);
                    dropdown.addEventListener("change", (function (num) {
                        return function () {
                            console.log("update cell " + num);
                            updateCell(num);
                        };
                    })(number));

                    imageDropdownData.forEach(function (image) {
                        var option = document.createElement("option");
                        option.value = image.url;
                        option.text = image.name;

                        dropdown.appendChild(option);
                    });

                    col.appendChild(dropdown);
                    row.appendChild(col);
                }

                gridContainer.appendChild(row);

            }
        }

        function initializeImageDropdowns() {
            var dropdowns = document.getElementsByClassName("imageDropdown");
            for (var i = 0; i < dropdowns.length; i++) {
                var dropdown = dropdowns[i];
                dropdown.addEventListener("change", function (event) {
                    console.log("update cell " + event.target.id);
                    updateCell(event.target.id);
                });
            }
        }

        function updateImageGrid() {
            var selectedTemplate = document.getElementById("labelDimensionsDropdown").value;
            var selectedDimension = labelDimensions.find(function (dimension) {
                return dimension.template === selectedTemplate;
            });

            var imageGridContainer = document.getElementById("imageGridContainer");
            imageGridContainer.innerHTML = "";

            for (var i = 0; i < selectedDimension.height; i++) {
                var row = document.createElement("div");
                row.classList.add("row");

                for (var j = 0; j < selectedDimension.width; j++) {
                    var col = document.createElement("div");
                    col.classList.add("col");
                    //restrict the size of the image
                    col.style.maxWidth = "100px";
                    col.style.maxHeight = "100px";

                    col.id = "imageCell" + (i * selectedDimension.width + j + 1);

                    var dropdownId = "cell" + (i * selectedDimension.width + j + 1);
                    var dropdown = document.getElementById(dropdownId).childNodes[1];

                    if (dropdown == null) {
                        return false;
                    }

                    var url = dropdown.value;

                    //make an image element and set the source to the url

                    var image = document.createElement("img");
                    image.src = url;
                    image.style.maxWidth = "100px";
                    image.style.maxHeight = "100px";

                    //if there is an existing image, remove it
                    if (col.childNodes.length > 0) {
                        col.removeChild(cell.childNodes[0]);
                    }
                    col .appendChild(image);


                    row.appendChild(col);
                }
                imageGridContainer.appendChild(row);

            }

        }

        function updateCell(number) {

            var cellId = "imageCell" + number;
            var cell = document.getElementById(cellId);

            if (cell == null) {
                return false;
            }

            var dropdownId = "cell" + number;
            var dropdown = document.getElementById(dropdownId).childNodes[1];

            if (dropdown == null) {
                return false;
            }

            var url = dropdown.value;

            //make an image element and set the source to the url

            var image = document.createElement("img");
            image.src = url;
            image.style.maxWidth = "100px";
            image.style.maxHeight = "100px";

            cell.innerHTML = "";
            //if there is an existing image, remove it
            if (cell.childNodes.length > 0) {
                cell.removeChild(cell.childNodes[0]);
            }
            cell.appendChild(image);
        }

        updateGrid();

        //request images and wait for response
        populateImageDropdown();
        
        initializeImageDropdowns();
        </script>


</body>

</html>