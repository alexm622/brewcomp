<!--/*FILEPATH: /home/alex/git/brewcomp/src/main/resources/templates/labelmaker/editor.html */-->

<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xml:lang>

<head>

    <th:block th:replace="~{fragments/header :: header}" />
    <title>My Website</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!--/*JQuery */-->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

    <!--/*PopperJS */-->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"></script>

    <!--/*Bootstrap */-->
    <script src=" https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js "></script>

    <!--/*Bootstrap Icons*/-->
    <link href=" https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.min.css " rel="stylesheet">

    <!--/*Bootswatch */-->
    <link class="theme" href="https://bootswatch.com/5/cerulean/bootstrap.min.css" rel="stylesheet">

    <!--/*Backbone.js */-->
    <script src="https://cdn.jsdelivr.net/npm/backbone@1.5.0/backbone-min.min.js"></script>

    <!--/*Underscore.js */-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.13.6/underscore-min.js"></script>


    <!--/*JQuery UI */-->
    <script src=" https://cdn.jsdelivr.net/npm/jqueryui@1.11.1/jquery-ui.min.js "></script>
    <link href=" https://cdn.jsdelivr.net/npm/jqueryui@1.11.1/jquery-ui.min.css " rel="stylesheet">
    </th:block>

    <link rel="stylesheet" href="https://uicdn.toast.com/tui-image-editor/latest/tui-image-editor.css" />
    <script src="https://uicdn.toast.com/tui-image-editor/latest/tui-image-editor.js"></script>


</head>

<body>
    <div id="image-editor"></div>
    <button id="submit-button">Submit</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/minio.js/7.0.1/minio.min.js"></script>
    <script>
        $(document).ready(function () {
            // Create a new instance of ToastUI Image Editor
            var imageEditor = new tui.ImageEditor('#image-editor', {
                includeUI: {
                    loadImage: {
                        path: 'https://samplelib.com/lib/preview/png/sample-boat-400x300.png',
                        name: 'Sample Image'
                    },
                    menu: ['shape', 'filter'],
                    initMenu: 'filter',
                    uiSize: {
                        width: '1000px',
                        height: '700px'
                    }
                },
                cssMaxWidth: 700,
                cssMaxHeight: 500,
                usageStatistics: false
            });

            // Add event listener to the submit button
            $('#submit-button').click(function () {
                var dataUrl = imageEditor.toDataURL();

                // Convert Base64 string to a Blob
                var byteString = atob(dataUrl.split(',')[1]);
                var mimeString = dataUrl.split(',')[0].split(':')[1].split(';')[0];
                var arrayBuffer = new ArrayBuffer(byteString.length);
                var uint8Array = new Uint8Array(arrayBuffer);
                for (var i = 0; i < byteString.length; i++) {
                    uint8Array[i] = byteString.charCodeAt(i);
                }
                var blob = new Blob([arrayBuffer], { type: mimeString });

                // Create a FormData object and append the Blob
                var formData = new FormData();
                formData.append('image', blob, 'image.png');

                // Initialize Minio client
                var minioClient = new Minio.Client({
                    endPoint: 'localhost',
                    port: 9000,
                    useSSL: false,
                    accessKey: '',
                    secretKey: ''
                });

                // Upload the image to the Minio bucket
                minioClient.putObject('chum', 'image.png', blob, function (err, etag) {
                    if (err) {
                        console.log(err);
                    } else {
                        console.log('Image uploaded successfully');
                    }
                });
            });
        });
    </script>
</body>
</html>